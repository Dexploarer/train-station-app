import{r as x,j as e,X as A,C as N,p as F,l as O,a as q,g as M,q as y,h as l}from"./index-FKmzij_1.js";import{u as V,B as H}from"./Breadcrumbs-CCWRCGTu.js";import{a as R,u as W,b as U}from"./useCRM-D8N1rZSr.js";import{C as Z}from"./CustomerFormModal-BIvNoG4j.js";import{M as E}from"./message-square-Df_PiQnb.js";import{S as Q}from"./save-DrKIf50q.js";import{f as p}from"./format-CWC1h8aK.js";import{C as X}from"./chevron-left-BZb8Pfj0.js";import{S as G}from"./square-pen-_Hdyo78T.js";import{T as I}from"./trash-CZRs4jB8.js";import{P as D}from"./phone-DyeO1QEd.js";import{M as J}from"./map-pin-mg8b7J78.js";import{C as K}from"./clock-C-ss61e7.js";import{T as Y}from"./tag-BH-xb0w9.js";import{P as _}from"./plus-KKCTwYn-.js";import"./chevron-right-uU2N22sE.js";import"./useMutation-Chvc8RUs.js";const ee=({isOpen:a,onClose:c,onSave:s,customerId:h,isSubmitting:g})=>{const[r,o]=x.useState({customerId:h,type:"note",date:p(new Date,"yyyy-MM-dd'T'HH:mm"),description:null,staffMember:null,relatedEntityId:null,relatedEntityType:null});x.useEffect(()=>{o(i=>({...i,customerId:h}))},[h]);const n=i=>{const{name:d,value:u}=i.target;o(j=>({...j,[d]:u||null}))},v=i=>{const d=i.target.value;o(u=>({...u,relatedEntityType:d||null,relatedEntityId:null}))},w=i=>{i.preventDefault(),s(r)};return a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"relative w-full max-w-md rounded-lg bg-zinc-900 shadow-xl",children:[e.jsxs("div",{className:"sticky top-0 z-10 flex items-center justify-between border-b border-zinc-700 bg-zinc-900 px-4 py-4",children:[e.jsx("h2",{className:"font-playfair text-xl font-semibold text-white",children:"Add Interaction"}),e.jsx("button",{onClick:c,className:"rounded-full p-2 text-gray-400 hover:bg-zinc-800 hover:text-white","aria-label":"Close",children:e.jsx(A,{size:20})})]}),e.jsxs("form",{onSubmit:w,className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-300",children:["Interaction Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"type",name:"type",value:r.type,onChange:n,required:!0,className:"mt-1 block w-full rounded-md border border-zinc-700 bg-zinc-800 px-3 py-2 text-white placeholder-gray-400 focus:border-amber-500 focus:outline-none focus:ring-amber-500",children:[e.jsx("option",{value:"note",children:"Note"}),e.jsx("option",{value:"call",children:"Phone Call"}),e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"meeting",children:"Meeting"}),e.jsx("option",{value:"event",children:"Event Attendance"}),e.jsx("option",{value:"purchase",children:"Purchase"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-300",children:["Date & Time ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsx(N,{size:16,className:"mr-2 text-gray-400"}),e.jsx("input",{type:"datetime-local",id:"date",name:"date",value:r.date,onChange:n,required:!0,className:"block w-full rounded-md border border-zinc-700 bg-zinc-800 px-3 py-2 text-white placeholder-gray-400 focus:border-amber-500 focus:outline-none focus:ring-amber-500"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-300",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"mt-1 flex",children:[e.jsx(E,{size:16,className:"mr-2 mt-3 flex-shrink-0 text-gray-400"}),e.jsx("textarea",{id:"description",name:"description",value:r.description||"",onChange:n,required:!0,rows:3,className:"block w-full rounded-md border border-zinc-700 bg-zinc-800 px-3 py-2 text-white placeholder-gray-400 focus:border-amber-500 focus:outline-none focus:ring-amber-500",placeholder:"Details about the interaction..."})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"staffMember",className:"block text-sm font-medium text-gray-300",children:"Staff Member"}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsx(F,{size:16,className:"mr-2 text-gray-400"}),e.jsx("input",{type:"text",id:"staffMember",name:"staffMember",value:r.staffMember||"",onChange:n,className:"block w-full rounded-md border border-zinc-700 bg-zinc-800 px-3 py-2 text-white placeholder-gray-400 focus:border-amber-500 focus:outline-none focus:ring-amber-500",placeholder:"Who handled this interaction?"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Related To"}),e.jsxs("div",{className:"mt-1 grid grid-cols-2 gap-4",children:[e.jsxs("select",{value:r.relatedEntityType||"",onChange:v,className:"block w-full rounded-md border border-zinc-700 bg-zinc-800 px-3 py-2 text-white shadow-sm focus:border-amber-500 focus:outline-none focus:ring-amber-500",children:[e.jsx("option",{value:"",children:"None"}),e.jsx("option",{value:"event",children:"Event"}),e.jsx("option",{value:"purchase",children:"Purchase"}),e.jsx("option",{value:"marketing",children:"Marketing Campaign"})]}),r.relatedEntityType&&e.jsxs("select",{value:r.relatedEntityId||"",onChange:i=>o(d=>({...d,relatedEntityId:i.target.value})),className:"block w-full rounded-md border border-zinc-700 bg-zinc-800 px-3 py-2 text-white shadow-sm focus:border-amber-500 focus:outline-none focus:ring-amber-500",children:[e.jsxs("option",{value:"",children:["Select ",r.relatedEntityType,"..."]}),e.jsxs("option",{value:"placeholder-1",children:["Example ",r.relatedEntityType," 1"]}),e.jsxs("option",{value:"placeholder-2",children:["Example ",r.relatedEntityType," 2"]})]})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:c,className:"rounded-lg bg-zinc-800 px-3 py-2 text-sm font-medium text-white hover:bg-zinc-700 focus:outline-none",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:g||!r.description,className:"inline-flex items-center rounded-lg bg-amber-600 px-3 py-2 text-sm font-medium text-white hover:bg-amber-700 focus:outline-none disabled:opacity-70",children:[e.jsx(Q,{size:16,className:"mr-2"}),g?"Saving...":"Save Interaction"]})]})]})]})}):null},ye=()=>{const{id:a}=O(),c=q(),{data:s,isLoading:h,isError:g}=R(a||""),{updateCustomer:r,deleteCustomer:o}=W(),{interactions:n,isLoading:v,createInteraction:w,deleteInteraction:i,isCreating:d}=U(a),u=V(),[j,z]=x.useState(!1),[S,f]=x.useState(!1),[P,C]=x.useState(!1),[k,b]=x.useState(!1),T=async t=>{if(a){b(!0);try{await r({id:a,updates:t}),z(!1),l.success("Customer updated successfully")}catch(m){l.error(`Error updating customer: ${m.message}`)}finally{b(!1)}}},$=async()=>{if(a){b(!0);try{await o(a),l.success("Customer deleted successfully"),c("/customers")}catch(t){l.error(`Error deleting customer: ${t.message}`)}finally{b(!1),C(!1)}}},L=async t=>{if(a)try{await w(t),f(!1),l.success("Interaction recorded successfully")}catch(m){l.error(`Error recording interaction: ${m.message}`)}},B=async t=>{try{await i(t),l.success("Interaction deleted")}catch(m){l.error(`Error deleting interaction: ${m.message}`)}};return h?e.jsxs("div",{className:"flex h-64 items-center justify-center",children:[e.jsx("div",{className:"mr-3 h-6 w-6 animate-spin rounded-full border-2 border-amber-500 border-t-transparent"}),e.jsx("p",{className:"text-lg text-white",children:"Loading customer details..."})]}):g||!s?e.jsxs("div",{className:"rounded-xl bg-zinc-900 p-8 text-center",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white",children:"Customer not found"}),e.jsx("p",{className:"mt-2 text-gray-400",children:"The customer you're looking for doesn't exist or you don't have permission to view it."}),e.jsx("button",{onClick:()=>c("/customers"),className:"mt-4 rounded-lg bg-amber-600 px-4 py-2 text-sm font-medium text-white hover:bg-amber-700",children:"Back to Customers"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(H,{items:u}),e.jsxs("div",{className:"flex flex-col items-start justify-between space-y-4 sm:flex-row sm:items-center sm:space-y-0",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>c("/customers"),className:"mb-2 flex items-center text-sm font-medium text-gray-400 hover:text-white",children:[e.jsx(X,{size:16,className:"mr-1"}),"Back to Customers"]}),e.jsxs("h1",{className:"font-playfair text-3xl font-bold tracking-tight text-white",children:[s.firstName," ",s.lastName]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>z(!0),className:"inline-flex items-center rounded-lg bg-zinc-800 px-3 py-2 text-sm font-medium text-white hover:bg-zinc-700 focus:outline-none",children:[e.jsx(G,{size:16,className:"mr-2"}),"Edit"]}),e.jsxs("button",{onClick:()=>C(!0),className:"inline-flex items-center rounded-lg bg-red-600 px-3 py-2 text-sm font-medium text-white hover:bg-red-700 focus:outline-none",children:[e.jsx(I,{size:16,className:"mr-2"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"rounded-xl bg-zinc-900 p-6 shadow-lg",children:[e.jsx("h2",{className:"mb-4 text-xl font-semibold text-white",children:"Customer Information"}),e.jsxs("div",{className:"grid grid-cols-1 gap-y-4 sm:grid-cols-2",children:[s.email&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(M,{size:16,className:"mr-2 mt-0.5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Email"}),e.jsx("p",{className:"text-sm text-white",children:s.email})]})]}),s.phone&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(D,{size:16,className:"mr-2 mt-0.5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Phone"}),e.jsx("p",{className:"text-sm text-white",children:s.phone})]})]}),(s.address||s.city||s.state)&&e.jsxs("div",{className:"flex items-start col-span-full",children:[e.jsx(J,{size:16,className:"mr-2 mt-0.5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Address"}),e.jsxs("p",{className:"text-sm text-white",children:[s.address&&`${s.address}, `,s.city&&`${s.city}, `,s.state,s.zip&&` ${s.zip}`]})]})]}),s.birthday&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(N,{size:16,className:"mr-2 mt-0.5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Birthday"}),e.jsx("p",{className:"text-sm text-white",children:p(new Date(s.birthday),"MMMM d, yyyy")})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(K,{size:16,className:"mr-2 mt-0.5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Customer Since"}),e.jsx("p",{className:"text-sm text-white",children:p(new Date(s.customerSince),"MMMM d, yyyy")})]})]}),s.lastVisit&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(N,{size:16,className:"mr-2 mt-0.5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Last Visit"}),e.jsx("p",{className:"text-sm text-white",children:p(new Date(s.lastVisit),"MMMM d, yyyy")})]})]})]}),s.notes&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"mb-2 text-sm font-medium text-gray-400",children:"Notes"}),e.jsx("p",{className:"text-gray-300",children:s.notes})]}),s.tags&&s.tags.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"mb-2 text-sm font-medium text-gray-400",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map((t,m)=>e.jsxs("span",{className:"inline-flex items-center rounded-full bg-zinc-800 px-2 py-1 text-xs font-medium text-gray-300",children:[e.jsx(Y,{size:10,className:"mr-1 text-amber-500"}),t]},m))})]})]}),e.jsxs("div",{className:"rounded-xl bg-zinc-900 p-6 shadow-lg",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Interaction History"}),e.jsxs("button",{onClick:()=>f(!0),className:"inline-flex items-center rounded-lg bg-amber-600 px-3 py-1 text-sm font-medium text-white hover:bg-amber-700 focus:outline-none",children:[e.jsx(_,{size:14,className:"mr-1"}),"Add Interaction"]})]}),v?e.jsxs("div",{className:"flex items-center justify-center py-10",children:[e.jsx("div",{className:"mr-3 h-5 w-5 animate-spin rounded-full border-2 border-amber-500 border-t-transparent"}),e.jsx("p",{className:"text-white",children:"Loading interactions..."})]}):n&&n.length>0?e.jsx("div",{className:"space-y-4",children:n.map(t=>e.jsx("div",{className:"rounded-lg bg-zinc-800 p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`
                          mr-3 h-8 w-8 flex-shrink-0 rounded-full flex items-center justify-center 
                          ${t.type==="call"?"bg-blue-600":t.type==="email"?"bg-green-600":t.type==="meeting"?"bg-purple-600":t.type==="purchase"?"bg-amber-600":"bg-gray-600"}
                        `,children:t.type==="call"?e.jsx(D,{size:16,className:"text-white"}):t.type==="email"?e.jsx(M,{size:16,className:"text-white"}):t.type==="meeting"?e.jsx(N,{size:16,className:"text-white"}):t.type==="purchase"?e.jsx(te,{size:16,className:"text-white"}):e.jsx(E,{size:16,className:"text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium text-white capitalize",children:t.type}),e.jsx("span",{className:"ml-2 text-xs text-gray-400",children:p(new Date(t.date),"MMM d, yyyy h:mm a")})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-300",children:t.description}),t.staffMember&&e.jsxs("div",{className:"mt-1 text-xs text-gray-400 flex items-center",children:[e.jsx("span",{className:"mr-1",children:"By:"}),e.jsx("span",{className:"font-medium",children:t.staffMember})]})]})]}),e.jsx("button",{onClick:()=>{window.confirm("Are you sure you want to delete this interaction?")&&B(t.id)},className:"ml-2 rounded p-1 text-gray-400 hover:bg-zinc-700 hover:text-white",children:e.jsx(I,{size:14})})]})},t.id))}):e.jsxs("div",{className:"rounded-lg bg-zinc-800 p-4 text-center",children:[e.jsx("p",{className:"text-sm text-gray-300",children:"No interactions recorded yet."}),e.jsx("button",{onClick:()=>f(!0),className:"mt-2 text-xs font-medium text-amber-500 hover:text-amber-400",children:"Add the first interaction"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"rounded-xl bg-zinc-900 p-6 shadow-lg",children:[e.jsx("h2",{className:"mb-4 text-xl font-semibold text-white",children:"Marketing Preferences"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(y,{size:14,className:"mr-2 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Email Promotions"})]}),e.jsx("div",{children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.marketingPreferences.emailPromotions?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.marketingPreferences.emailPromotions?"Enabled":"Disabled"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(y,{size:14,className:"mr-2 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-300",children:"SMS Notifications"})]}),e.jsx("div",{children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.marketingPreferences.smsNotifications?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.marketingPreferences.smsNotifications?"Enabled":"Disabled"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(y,{size:14,className:"mr-2 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Newsletter"})]}),e.jsx("div",{children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.marketingPreferences.newsletter?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.marketingPreferences.newsletter?"Enabled":"Disabled"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(y,{size:14,className:"mr-2 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Special Events"})]}),e.jsx("div",{children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.marketingPreferences.specialEvents?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.marketingPreferences.specialEvents?"Enabled":"Disabled"})})]}),s.marketingPreferences.unsubscribed&&e.jsx("div",{className:"mt-4 rounded-lg bg-red-900/20 p-3 text-center",children:e.jsx("p",{className:"text-xs font-medium text-red-400",children:"Customer has unsubscribed from all communications"})})]})]}),e.jsxs("div",{className:"rounded-xl bg-zinc-900 p-6 shadow-lg",children:[e.jsx("h2",{className:"mb-4 text-xl font-semibold text-white",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>f(!0),className:"flex w-full items-center justify-between rounded-lg bg-zinc-800 p-3 text-left text-white hover:bg-zinc-700",children:[e.jsx("span",{children:"Log Interaction"}),e.jsx(E,{size:16,className:"text-gray-400"})]}),e.jsxs("button",{onClick:()=>window.location.href=`mailto:${s.email}`,className:"flex w-full items-center justify-between rounded-lg bg-zinc-800 p-3 text-left text-white hover:bg-zinc-700",disabled:!s.email,children:[e.jsx("span",{children:"Send Email"}),e.jsx(M,{size:16,className:"text-gray-400"})]}),e.jsxs("button",{onClick:()=>c("/ticketing/create"),className:"flex w-full items-center justify-between rounded-lg bg-zinc-800 p-3 text-left text-white hover:bg-zinc-700",children:[e.jsx("span",{children:"Add to Event"}),e.jsx(se,{size:16,className:"text-gray-400"})]})]})]})]})]}),j&&e.jsx(Z,{isOpen:j,onClose:()=>z(!1),onSave:T,initialCustomer:s,isSubmitting:k}),S&&e.jsx(ee,{isOpen:S,onClose:()=>f(!1),onSave:L,customerId:a||"",isSubmitting:d}),P&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"w-full max-w-md rounded-lg bg-zinc-900 p-6 shadow-xl",children:[e.jsx("h3",{className:"mb-4 text-xl font-semibold text-white",children:"Confirm Deletion"}),e.jsxs("p",{className:"mb-6 text-gray-300",children:["Are you sure you want to delete ",e.jsxs("span",{className:"font-medium text-white",children:[s.firstName," ",s.lastName]}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>C(!1),className:"rounded-lg bg-zinc-800 px-4 py-2 text-sm font-medium text-white hover:bg-zinc-700 focus:outline-none",children:"Cancel"}),e.jsx("button",{onClick:$,disabled:k,className:"rounded-lg bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700 focus:outline-none disabled:opacity-70",children:k?"Deleting...":"Delete Customer"})]})]})})]})};function se(a){return e.jsxs("svg",{...a,xmlns:"http://www.w3.org/2000/svg",width:a.size||24,height:a.size||24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"}),e.jsx("path",{d:"M13 5v2"}),e.jsx("path",{d:"M13 17v2"}),e.jsx("path",{d:"M13 11v2"})]})}function te(a){return e.jsxs("svg",{...a,xmlns:"http://www.w3.org/2000/svg",width:a.size||24,height:a.size||24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"}),e.jsx("path",{d:"M16 10a4 4 0 0 1-8 0"}),e.jsx("path",{d:"M3 6h18"})]})}export{ye as default};
